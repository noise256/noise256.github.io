<!DOCTYPE html>

<html>
	<head>
		<title>Flocking</title>
		
		<meta charset="UTF-8"> 
		<LINK href="starlings.css" rel="stylesheet" type="text/css">
		
		<script src="OnLoad.js" type="text/javascript"></script>
		<script src="js/sylvester.src.js" type="text/javascript"></script>
		<script src="js/fpsmeter.js" type="text/javascript"></script>
		<script src="js/three.min.js" type="text/javascript"></script>
		<script src="js/OrbitControls.js" type="text/javascript"></script>
		<script src="spp.js" type="text/javascript"></script>
		<script src="spp_model.js" type="text/javascript"></script>
	</head>
	
	<!-- Based on Three.js "Getting Started" tutorial. -->
	<body onload="OnLoad()">
		<div id="WebGLCanvas"; style="margin:auto; text-align:center; width: 1000px; height: 800px; border:1px solid white;">
			<script>
				this.canvasWidth = 1000;
				this.canvasHeight = 800;
				
				<!--Time Step based on http://codeincomplete.com/posts/2013/12/4/javascript_game_foundations_the_game_loop/ -->
				var now;
				var dt = 0;
				var last = timestamp();
				var step = 1/60;
				
				<!-- FPSMeter -->
				var fpsMeter = new FPSMeter(document.body, { decimals: 0, graph: true, theme: 'dark', left: '5px' });
				
				<!-- Scene, Camera and Renderer declaration and initialisation. -->
				//var canvasWidth = document.getElementById("WebGLCanvas").clientWidth;
				//var canvasHeight = document.getElementById("WebGLCanvas").clientHeight;
				
				<!-- Scene Creation -->
				var scene = new THREE.Scene();
				//scene.fog = new THREE.FogExp2( 0xefd1b5, 0.025 );
				
				<!-- Camera Creation -->
				var camera = new THREE.PerspectiveCamera(60, canvasWidth / canvasHeight, 0.1, 1000);
				
				camera.position.x = 24
				camera.position.y = 10;
				camera.position.z = 24;
				
				camera.lookAt(new THREE.Vector3(0, 10, 0));
				
				var renderer = new THREE.WebGLRenderer();			
				renderer.setSize(canvasWidth, canvasHeight);
				document.getElementById("WebGLCanvas").appendChild(renderer.domElement);
				
				var controls = new THREE.OrbitControls(camera);
				controls.target.y = 10;
				
				<!-- Ground Plane Creation -->
				var geometry = new THREE.PlaneGeometry(20, 20, 20, 20);
				var basicGroundMat = new THREE.MeshBasicMaterial({color: 0xF7D480, wireframe: true});
				var mesh = new THREE.Mesh(geometry, basicGroundMat);
				mesh.rotation.x = -Math.PI/2;
				
				scene.add(mesh);
				
				<!-- Lighting setup -->
				var ambient01 = new THREE.AmbientLight(0x404040);
				scene.add(ambient01);
				
				var pointLight = new THREE.PointLight();
				pointLight.position.set(50, 150, 150);
				scene.add(pointLight);
				
				<!-- SPP creation -->
				var sppModel = new SPPModel(100);
				var sppModelView = sppModel.getView();
				
				for (var i = 0; i < sppModelView.length; i++) {
					var sppView = sppModelView[i];
					scene.add(sppView);
				}
				
				<!-- Time Step function -->
				function timestamp() {
					if (window.performance && window.performance.now) {
						return window.performance.now();
					}
					else {
						return new Date().getTime();
					}
				}
				
				<!-- Update function -->
				function update(dt) {
					sppModel.updateSPPModel();
				}
				
				<!-- Render function -->
				function render(dt) {
					renderer.render(scene, camera);
				}
				
				<!-- Frame function -->
				function frame() {
					fpsMeter.tickStart();
					
					now = timestamp();
					dt = dt + Math.min(1, (now - last) / 1000);
					
					while (dt > step) {
						dt = dt - step;
						update(dt);
					}
					render(dt);
					
					requestAnimationFrame(frame);
					
					last = now;
					fpsMeter.tick();
				};
				
				window.onload=function(){
					alert("Loaded here too.");
				};
				<!-- Initialise -->
				frame();
			</script>
		</div>
		<p>
		LMB: zoom, MMB: Pan, RB: Rotate. After some initial testing it appears that performance is substantially better in Chrome than in Firefox. More rigorous testing and optimisation will be done soon but for now I suggest using Google Chrome if you are having any performance issues.
		</p>
	</body>
</html>