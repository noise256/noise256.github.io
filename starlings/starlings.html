<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8"> 
		<!-- <LINK href="eta_carinae.css" rel="stylesheet" type="text/css"> -->
		<title>Flocking</title>
		<style>body { background-color:#000000; } </style>
		
		<script src="js/sylvester.src.js" type="text/javascript"></script>
		<script src="js/fpsmeter.js" type="text/javascript"></script>
		<script src="js/three.min.js" type="text/javascript"></script>
		<script src="js/spp.js" type="text/javascript"></script>
		<script src="js/spp_model.js" type="text/javascript"></script>
	</head>
	
	<!-- Based on Three.js "Getting Started" tutorial. -->
	<body>
		<div id="WebGLCanvas" style="margin:auto; text-align:center; width: 1000px; height: 800px; border:1px solid white;">
			<script>
				<!--Time Step based on http://codeincomplete.com/posts/2013/12/4/javascript_game_foundations_the_game_loop/ -->
				var now;
				var dt = 0;
				var last = timestamp();
				var step = 1/60;
				
				<!-- FPSMeter -->
				var fpsMeter = new FPSMeter(document.body, { decimals: 0, graph: true, theme: 'dark', left: '5px' });
				
				<!-- Scene, Camera and Renderer declaration and initialisation. -->
				var canvasWidth = document.getElementById("WebGLCanvas").clientWidth;
				var canvasHeight = document.getElementById("WebGLCanvas").clientHeight;
				
				var scene = new THREE.Scene();
				
				var camera = new THREE.PerspectiveCamera(75, canvasWidth / canvasHeight, 0.1, 1000);
				camera.position.z = 5;
				
				var renderer = new THREE.WebGLRenderer();			
				renderer.setSize(canvasWidth, canvasHeight);
				document.getElementById("WebGLCanvas").appendChild(renderer.domElement);
				
				<!-- Lighting setup -->
				var ambient01 = new THREE.AmbientLight(0x404040);
				scene.add(ambient01);
				
				var pointLight = new THREE.PointLight();
				pointLight.position.set(50, 150, 150);
				scene.add(pointLight);
				
				<!-- Scene creation -->
				var sppModel = new SPPModel(30);
				var sppModelView = sppModel.getView();
				
				for (var i = 0; i < sppModelView.length; i++) {
					var sppView = sppModelView[i];
					scene.add(sppView);
				}
				
				<!-- Time Step function -->
				function timestamp() {
					if (window.performance && window.performance.now) {
						return window.performance.now();
					}
					else {
						return new Date().getTime();
					}
				}
				
				<!-- Update function -->
				function update(dt) {
					sppModel.updateSPPModel();
				}
				
				<!-- Render function -->
				function render(dt) {
					renderer.render(scene, camera);
				}
				
				<!-- Frame function -->
				function frame() {
					fpsMeter.tickStart();
					
					now = timestamp();
					dt = dt + Math.min(1, (now - last) / 1000);
					
					while (dt > step) {
						dt = dt - step;
						update(dt);
					}
					render(dt);
					
					requestAnimationFrame(frame);
					
					last = now;
					fpsMeter.tick();
				};
				
				<!-- Initialise -->
				frame();
			</script>
		</div>
	</body>
</html>